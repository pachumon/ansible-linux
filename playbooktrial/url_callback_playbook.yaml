#===================================================================================#
# this playbook calls a specific url as call back from the ansible playbook
# INPUT PARAMS
# host: host name of the execution server
# callback_endpoint: the amelia or any specific callback endpoint that needs to be invoked
#===================================================================================#

---
- name: Execute specific command on server
  hosts: "{{ host_name }}"

  tasks:
    - name: Send HTTP request to a callback url endpoint
      ansible.builtin.uri:
        url: "{{ callback_endpoint }}" # Replace with desired Amelia callback URL
        user: "{{ callback_username }}"
        password: "{{ callback_password }}"
        method: POST
        body: 
          aoTaskId: "{{ao_task_id}}"
          callback_state: "{{ callback_state }}"
          payload: "{{ callback_payload|to_json }}"
        body_format: json
        status_code: 200 # need to confirm if it is 200 or 201
        headers:
          Content-Type: application/json
          X-Hypera-Reply-Sync: true
          X-Amelia-ClientKey: "{{ amelia_client_key }}"
          X-DomainCode: "{{ amelia_domain_code }}"
      register: response
      until: "response.status == 200"
      retries: 3
      delay: 10


    - name: Display response
      ansible.builtin.debug:
        var: response
