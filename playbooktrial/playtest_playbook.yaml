---
- name: Verify JVM logs and restart service
  hosts: localhost

  tasks:
    - name: check if specific file exist
      become: true
      ansible.builtin.find:
        paths: "{{ file_path }}"
        patterns: "{{ item }}"
        recurse: no
        age: -5m
      register: file_info
      with_items:
        - heapdump*
        - javacore*

    - name: Check if error text is present
      shell: echo "{{ file_info }}" | grep -q "'matched':\ 1"
      register: grep_result
      ignore_errors: yes

    - name: Display the result
      ansible.builtin.debug:
        msg: "{{ grep_result }}"

    - ansible.builtin.debug:
        var: file_info
      when: grep_result.rc== '0'

    - ansible.builtin.debug:
        msg: >
          {% for result in file_info.results %}
           {% if result.matched == 1 %}
              {% print('kumbidi') %}
            {% endif %}
          {% endfor %}

    # - name: "check command"
    #   shell: echo hello
    #   register: var
    #   until: var.stdout.find('hi') != -1
    #   retries: 5
    #   delay: 10

    # - ansible.builtin.debug:
    #     var: file_info

    - name: Check multi line script
      shell: |
        ps -elf | grep -v grep | grep sleep | awk '{print $4}'            
      register: pid_result
      #with_sequence: count=3

    - ansible.builtin.debug:
        var: pid_result
     

  
